---
title: "Work Doc - Palma"
author: "Palma"
date: "11/16/2021"
output: html_document
---


For the projects, I want to give some suggested due dates:

Friday 11/19: 1. Create a GitHub project and add collaborators (I'll go through an example of this on Tuesday). 2. At least 1 data source obtained,  data read in to R, basic visualizations/summarizations to verify data is as expected. Start doing some data cleaning. 3. Outline of analysis plan with some of the steps completed.

Tuesday 11/23: 1. Read in and clean other two sources of data. 2. Finish a couple of the analysis steps and write them up completely. I recommend focusing on the "final product" first. 3. Create an RMarkdown file for the "behind-the-scenes" report and be sure to keep track of any detailed explanations of methods and code there. 

Thursday 12/2: 1. Complete most of the analyses and have a draft of the "final product". 2. Begin creating a presentation. 3. Create a detailed outline of what will go in the "behind-the-scenes". 

Tuesday 12/7: 1. "Final product" complete. 2. Finish the 15 minute presentation and practice it with your group. 

Thursday 12/9: 1. Submit "final product" on moodle. 2. Give presentations - we may need to use a bit of the lunch hour. 

Thursday 12/16: Submit "behind-the-scenes" (you can always submit early, if you'd like). 


```{r}
library(nflfastR)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggrepel)
library(stringr)
library(lubridate)

library(tidymodels)        # for modeling
library(themis)            # for step functions for unbalanced data
library(doParallel)        # for parallel processing
library(stacks)            # for stacking models
library(naniar)            # for examining missing values (NAs)
library(moderndive)        # for King County housing data
library(vip)               # for variable importance plots
library(patchwork)         # for combining plots nicely
library(ranger)
library(xgboost)
pbp_2021 <- load_pbp(2021)
```

```{r}
https://opensource.pysport.org/project/nflscrapR

# use in intro to show two min drill effect on win prob


```

```{r}
devtools::install_github(repo = "maksimhorowitz/nflscrapR")
# or the following (these are the exact same packages):
devtools::install_github(repo = "ryurko/nflscrapR")
```


```{r}
library(nflscrapR)

```


```{r}
Two_min_drill <- pbp_2021 %>% 
  filter(half_seconds_remaining<120, as.numeric(ms(drive_game_clock_start))<150) 
  
two_min_new <- Two_min_drill %>% 
  group_by(game_id, drive) %>%
  select(drive_play_count, ydsnet, drive_game_clock_start, fixed_drive_result) %>%
  mutate(td = ifelse(fixed_drive_result=='Touchdown', 1, 0),
  fg = ifelse(fixed_drive_result=='Field goal', 1, 0)) %>%
  ungroup()

```


```{r}
two_min_new
```

```{r}
two_min_final <- 
  two_min_new %>%
  mutate(game_id = as.factor(game_id), 
         drive_game_clock_start = as.factor(drive_game_clock_start), 
         fixed_drive_result = as.factor(fixed_drive_result))
```

```{r}
two_min_final
```


```{r}
two_min_final %>%
  count(game_id)
```

```{r}
two_min_final %>%
  count(drive)
```

```{r}
two_min_final %>%
  count(drive_play_count)
```

```{r}
two_min_final %>%
  count(ydsnet)
```

```{r}
two_min_final %>%
  count(drive_game_clock_start)
```

```{r}
two_min_final %>%
  count(fixed_drive_result)
```


```{r}
two_min_final %>%
  count(td)
```

```{r}
two_min_final %>%
  count(fg)
```


1.  Exploring Data


**Quant Vars**

```{r}
two_min_final %>% 
  select(where(is.numeric)) %>% 
  pivot_longer(cols = everything(),
               names_to = "variable", 
               values_to = "value") %>% 
  ggplot(aes(x = value)) +
  geom_histogram(bins = 30) +
  facet_wrap(vars(variable), 
             scales = "free")
```

**Categorical**

```{r}
two_min_final %>%
select(where(is.factor)) %>% 
  pivot_longer(cols = everything(),
               names_to = "variable", 
               values_to = "value") %>% 
  ggplot(aes(x = value)) +
  geom_bar() +
  facet_wrap(vars(variable), 
             scales = "free", 
             nrow = 3)
```






